<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>SOLE MATES</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        /* ALL YOUR EXISTING STYLES HERE - EXACTLY AS BEFORE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            background: #f8f6f2;
            color: #1a1a1a;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .popup-banner {
            background: #f2c94c;
            color: #1a1a1a;
            text-align: center;
            padding: 0.8rem;
            font-weight: 700;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            position: sticky;
            top: 0;
            z-index: 999;
            border-bottom: 3px solid #dbaa2c;
            display: none;
            animation: pulse 2s infinite;
            width: 100%;
        }
        @keyframes pulse {
            0% { background-color: #f2c94c; }
            50% { background-color: #ffd966; }
            100% { background-color: #f2c94c; }
        }
        .close-popup {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 1.2rem;
            background: rgba(0,0,0,0.1);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header {
            background: white;
            padding: 0.6rem 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 3px solid #f2c94c;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .logo i {
            font-size: clamp(1.8rem, 6vw, 2.4rem);
            color: #2b2b2b;
            filter: drop-shadow(2px 2px 0 #f2c94c);
        }
        .logo span {
            font-weight: 800;
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            letter-spacing: -0.5px;
            background: linear-gradient(145deg, #232323, #3a3a3a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .cart-stack {
            position: relative;
            cursor: pointer;
        }
        .cart-stack i {
            font-size: clamp(1.6rem, 5vw, 2rem);
            color: #232323;
        }
        .cart-count {
            position: absolute;
            top: -8px;
            right: -10px;
            background: #f2c94c;
            color: #000;
            font-size: 0.7rem;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 40px;
            border: 2px solid white;
            min-width: 22px;
            text-align: center;
        }
        .container {
            max-width: 1300px;
            margin: 1rem auto;
            padding: 0 0.8rem;
            flex: 1;
            width: 100%;
        }
        .tagline-section {
            text-align: center;
            margin-bottom: 1rem;
        }
        .main-tagline {
            font-size: clamp(1.1rem, 5vw, 1.5rem);
            font-weight: 600;
            color: #2b2b2b;
            margin-bottom: 0.3rem;
        }
        .sub-tagline {
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            color: #666;
            font-style: italic;
        }
        .offer-ribbon {
            background: #1e1e1e;
            color: #f2c94c;
            text-align: center;
            padding: 0.6rem 0.8rem;
            border-radius: 40px;
            font-weight: 700;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            margin: 1rem 0 1.5rem;
            border: 2px solid #f2c94c;
            box-shadow: 0 4px 0 #f2c94c;
        }
        
        /* Search Bar Styles */
        .search-container {
            margin: 1.5rem 0;
            display: flex;
            justify-content: center;
        }
        .search-box {
            width: 100%;
            max-width: 500px;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 3px solid #f2c94c;
            border-radius: 50px;
            font-size: 1rem;
            outline: none;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #f2c94c;
            font-size: 1.2rem;
        }
        
        .product-grid-wrapper {
            position: relative;
            padding: 1rem 0;
            margin: 1rem 0;
            border-radius: 30px;
            overflow: hidden;
        }
        .product-grid-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExNzFsaDRxaGJmazN1aWtseTg3YzdhMGZ6eHp5d3Rhd3o1ZWhrZncycSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/qMv7h5m2aognsF7Ael/giphy.gif');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin: 0;
            position: relative;
            z-index: 1;
        }
        @media (min-width: 480px) {
            .product-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 1.5rem;
            }
        }
        .product-card {
            background: white;
            border-radius: 28px;
            padding: 1rem 0.8rem 1.2rem;
            box-shadow: 0 10px 20px -8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }
        .product-card:active {
            transform: scale(0.98);
            background: #fffbf0;
        }
        .new-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #f2c94c;
            color: #1a1a1a;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.7rem;
            z-index: 2;
        }
        .discount-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #ff4444;
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.7rem;
            z-index: 2;
        }
        .size-badge {
            position: absolute;
            bottom: 8px;
            left: 8px;
            background: #333;
            color: white;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.7rem;
            z-index: 2;
        }
        .product-image {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 30px;
            margin-bottom: 0.8rem;
            border: 3px solid #f2c94c;
            transition: transform 0.2s;
        }
        @media (min-width: 480px) {
            .product-image {
                width: 140px;
                height: 140px;
            }
        }
        .product-name {
            font-weight: 800;
            font-size: clamp(1rem, 4vw, 1.2rem);
            margin: 0.2rem 0;
        }
        .product-description {
            font-size: 0.8rem;
            color: #5a5a5a;
            padding: 0 0.3rem;
        }
        .product-price {
            font-weight: 800;
            font-size: clamp(1.2rem, 5vw, 1.5rem);
            color: #1e1e1e;
            margin: 0.3rem 0;
        }
        .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 0.9rem;
            margin-right: 5px;
        }
        .product-actions {
            display: flex;
            gap: 0.5rem;
            width: 100%;
            margin-top: 0.5rem;
        }
        .add-btn, .buy-btn {
            flex: 1;
            border: none;
            border-radius: 40px;
            padding: 0.6rem 0.5rem;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            cursor: pointer;
            transition: 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        .add-btn {
            background: #f2c94c;
            border: 1px solid #dbaa2c;
        }
        .buy-btn {
            background: #25D366;
            color: white;
            border: 1px solid #128C7E;
        }
        .add-btn:active { 
            transform: scale(0.95); 
            background: #e5bb3c;
        }
        .buy-btn:active { 
            transform: scale(0.95); 
            background: #20b859;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 2000;
            overflow-y: auto;
            padding: 10px;
        }
        .modal-content {
            background: white;
            max-width: 1200px;
            margin: 20px auto;
            border-radius: 35px;
            padding: 1.5rem;
            position: relative;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        @media (max-width: 480px) {
            .modal-content {
                padding: 1rem;
                border-radius: 25px;
            }
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .close-modal {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            z-index: 10;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border-radius: 50%;
        }
        .modal-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 768px) {
            .modal-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        .modal-images {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        .main-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 25px;
            border: 3px solid #f2c94c;
            background: #f5f5f5;
            cursor: zoom-in;
        }
        .main-image {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
            transition: transform 0.3s ease;
            display: block;
        }
        .main-image.zoomed {
            transform: scale(1.5);
            cursor: zoom-out;
        }
        .zoom-hint {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            pointer-events: none;
        }
        .thumbnail-grid {
            display: flex;
            gap: 0.8rem;
            overflow-x: auto;
            padding: 0.3rem 0;
            -webkit-overflow-scrolling: touch;
        }
        .thumbnail {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 15px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: 0.2s;
            flex-shrink: 0;
        }
        .thumbnail:hover, .thumbnail.active {
            border-color: #f2c94c;
            transform: scale(1.05);
        }
        .modal-info {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        .modal-title {
            font-size: clamp(1.5rem, 6vw, 2.2rem);
            font-weight: 800;
            line-height: 1.2;
        }
        .price-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .modal-price {
            font-size: clamp(1.8rem, 6vw, 2.2rem);
            font-weight: 800;
            color: #f2c94c;
        }
        .modal .original-price {
            text-decoration: line-through;
            color: #999;
            font-size: 1.2rem;
        }
        .rating-section {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        .stars {
            display: flex;
            gap: 2px;
            color: #f2c94c;
            font-size: 1.2rem;
        }
        .rating-text {
            color: #666;
            font-size: 0.9rem;
        }
        .modal-description {
            font-size: 1rem;
            color: #444;
            line-height: 1.6;
        }
        .size-selection {
            background: #f5f5f5;
            border-radius: 25px;
            padding: 1rem;
        }
        .size-title {
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .size-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }
        .size-btn {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            border: 2px solid #ddd;
            background: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .size-btn:hover, .size-btn.selected {
            background: #f2c94c;
            border-color: #dbaa2c;
            transform: scale(1.05);
        }
        .size-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #f5f5f5;
            border-radius: 40px;
            padding: 0.5rem 1rem;
            justify-content: space-between;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: #f2c94c;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .quantity-btn:active {
            transform: scale(0.9);
        }
        .quantity-display {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 30px;
            text-align: center;
        }
        .coupon-section {
            background: #f0f7f0;
            border-radius: 25px;
            padding: 1rem;
            border: 2px dashed #28a745;
        }
        .coupon-input {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }
        .coupon-input input {
            flex: 1;
            padding: 0.7rem;
            border: 2px solid #ddd;
            border-radius: 30px;
            outline: none;
        }
        .coupon-input button {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0.7rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
        }
        .delivery-options {
            background: #f5f5f5;
            border-radius: 25px;
            padding: 1rem;
        }
        .delivery-option {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.8rem;
            margin: 0.5rem 0;
            background: white;
            border-radius: 40px;
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }
        .delivery-option:hover {
            border-color: #f2c94c;
        }
        .delivery-option input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #f2c94c;
        }
        .delivery-option span {
            flex: 1;
            font-weight: 500;
        }
        .address-section {
            background: #f5f5f5;
            border-radius: 25px;
            padding: 1rem;
        }
        .address-input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: 30px;
            margin: 0.5rem 0;
            outline: none;
        }
        .detect-location-btn {
            background: #4285F4;
            color: white;
            border: none;
            border-radius: 40px;
            padding: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
            margin: 0.5rem 0;
        }
        .delivery-fee-note {
            font-size: 0.85rem;
            color: #28a745;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #e8f5e9;
            border-radius: 30px;
            text-align: center;
            font-weight: 600;
        }
        .comments-section {
            background: #f5f5f5;
            border-radius: 25px;
            padding: 1.2rem;
            margin-top: 0.5rem;
        }
        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .comments-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 0.8rem 0;
            -webkit-overflow-scrolling: touch;
        }
        .comment-item {
            background: white;
            padding: 0.8rem;
            border-radius: 18px;
            margin-bottom: 0.5rem;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.3rem;
        }
        .comment-author {
            font-weight: 700;
            color: #f2c94c;
        }
        .comment-rating {
            color: #f2c94c;
            font-size: 0.8rem;
        }
        .comment-text {
            font-size: 0.9rem;
            color: #333;
        }
        .comment-date {
            font-size: 0.7rem;
            color: #999;
            margin-top: 0.3rem;
            text-align: right;
        }
        .comment-input {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            margin-top: 1rem;
        }
        .comment-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .comment-row input {
            flex: 1;
            min-width: 120px;
            padding: 0.7rem;
            border: 2px solid #ddd;
            border-radius: 30px;
            outline: none;
            font-size: 0.9rem;
        }
        .rating-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
        }
        .rating-input span {
            color: #f2c94c;
            font-size: 1.5rem;
            cursor: pointer;
            transition: 0.1s;
        }
        .rating-input span:hover,
        .rating-input span.active {
            transform: scale(1.2);
        }
        .comment-actions button {
            background: #f2c94c;
            border: none;
            border-radius: 30px;
            padding: 0.7rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        .modal-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .modal-add-btn, .modal-buy-btn {
            flex: 1;
            border: none;
            border-radius: 50px;
            padding: 1rem;
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-add-btn {
            background: #f2c94c;
            color: black;
        }
        .modal-buy-btn {
            background: #25D366;
            color: white;
        }
        .cart-overlay {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            justify-content: flex-end;
        }
        .cart-panel {
            background: white;
            width: 100%;
            max-width: 400px;
            height: 100%;
            padding: 1.5rem 1rem;
            overflow-y: auto;
            border-left: 4px solid #f2c94c;
            -webkit-overflow-scrolling: touch;
        }
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px dashed #ddd;
            padding-bottom: 0.8rem;
        }
        .close-cart {
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cart-items {
            flex: 1;
            margin: 1rem 0;
        }
        .cart-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: #f7f5f0;
            border-radius: 20px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
        }
        .cart-item-image {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 15px;
            border: 2px solid #f2c94c;
        }
        .cart-item-info { 
            flex: 1; 
            font-size: 0.9rem;
        }
        .cart-item-size {
            font-size: 0.8rem;
            color: #666;
            margin-top: 2px;
        }
        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 5px;
        }
        .cart-qty-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: none;
            background: #f2c94c;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .remove-item {
            background: none;
            border: none;
            color: #b91c1c;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }
        .cart-footer {
            border-top: 2px solid #eee;
            padding-top: 1rem;
        }
        .free-ship-note {
            background: #deeed8;
            border-radius: 25px;
            padding: 0.6rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }
        .total-section {
            background: #f2c94c20;
            border-radius: 25px;
            padding: 1rem;
            margin: 0.5rem 0;
            border: 2px solid #f2c94c;
        }
        .total-row {
            display: flex;
            justify-content: space-between;
            margin: 0.3rem 0;
        }
        .grand-total {
            font-size: 1.3rem;
            font-weight: 800;
            color: #f2c94c;
            border-top: 2px dashed #f2c94c;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }
        .whatsapp-checkout {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0.8rem;
            width: 100%;
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 0.8rem 0;
            cursor: pointer;
            border: 2px solid #128C7E;
        }
        .footer {
            background: #1e1e1e;
            color: white;
            padding: 2rem 1rem 1rem;
            margin-top: 2rem;
            border-top: 4px solid #f2c94c;
            overflow: hidden;
        }
        .footer-content {
            max-width: 1300px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .footer-section h3 {
            color: #f2c94c;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }
        .footer-section p, .footer-section a {
            color: #ccc;
            text-decoration: none;
            line-height: 1.8;
        }
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .social-links a {
            color: white;
            background: #333;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .social-links a:hover {
            background: #f2c94c;
            color: #1a1a1a;
            transform: translateY(-3px);
        }
        .footer-gif {
            width: 100%;
            height: 80px;
            background: linear-gradient(90deg, transparent, rgba(242,201,76,0.1), transparent);
            border-radius: 40px;
            margin: 1rem 0;
            overflow: hidden;
            position: relative;
        }
        .walking-shoe-gif {
            width: 200px;
            height: 80px;
            object-fit: cover;
            object-position: left;
            animation: walk 15s linear infinite;
        }
        @keyframes walk {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400%); }
        }
        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.9rem;
        }
        .no-reviews {
            color: #999;
            text-align: center;
            padding: 1rem;
            font-style: italic;
        }
        .admin-corner {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.7rem;
            opacity: 0.6;
            transition: 0.2s;
        }
        .admin-corner:hover {
            opacity: 1;
        }
        .admin-corner button {
            background: none;
            border: 1px solid #f2c94c;
            color: #f2c94c;
            padding: 0.3rem 1rem;
            border-radius: 40px;
            font-size: 0.7rem;
            cursor: pointer;
        }
        .admin-panel {
            display: none;
            background: #1a1a1a;
            color: white;
            padding: 1.5rem;
            border-radius: 0;
            margin: 1rem 0 0 0;
            width: 100%;
            border-top: 3px solid #f2c94c;
            border-bottom: 3px solid #f2c94c;
            box-sizing: border-box;
        }
        .admin-panel .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .admin-panel .close-admin {
            background: #f2c94c;
            border: none;
            border-radius: 30px;
            padding: 0.8rem 2rem;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            min-width: 120px;
        }
        .admin-sections-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .admin-section {
            background: #2d2d2d;
            border-radius: 30px;
            padding: 1.5rem;
            border: 2px solid #f2c94c;
            margin-bottom: 1.5rem;
        }
        .admin-section h3 {
            color: #f2c94c;
            margin-bottom: 1.2rem;
            font-size: 1.3rem;
        }
        .admin-form-group {
            margin-bottom: 1.2rem;
        }
        .admin-form-group label {
            color: #f2c94c;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
        }
        .admin-form-group input, .admin-form-group textarea, .admin-form-group select {
            width: 100%;
            padding: 0.9rem 1rem;
            background: #3d3d3d;
            border: 2px solid #5a5a5a;
            border-radius: 30px;
            color: white;
            font-size: 1rem;
        }
        .size-selector-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin: 1rem 0;
        }
        .size-checkbox {
            background: #3d3d3d;
            border: 2px solid #5a5a5a;
            border-radius: 15px;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .size-checkbox:hover {
            border-color: #f2c94c;
        }
        .size-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #f2c94c;
        }
        .size-checkbox span {
            font-weight: 600;
        }
        .admin-btn, .admin-btn-danger, .admin-btn-success, .admin-btn-warning {
            border: none;
            border-radius: 30px;
            padding: 0.9rem 1.5rem;
            font-weight: 700;
            font-size: 1rem;
            margin: 0.3rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .admin-btn {
            background: #f2c94c;
            color: black;
        }
        .admin-btn-danger { 
            background: #dc3545; 
            color: white; 
        }
        .admin-btn-success { 
            background: #28a745; 
            color: white; 
        }
        .admin-btn-warning { 
            background: #ffc107; 
            color: black; 
        }
        .admin-button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin: 1rem 0;
            align-items: center;
        }
        .admin-image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px,1fr));
            gap: 0.8rem;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 0.5rem;
            background: #3d3d3d;
            border-radius: 20px;
        }
        .admin-image-item {
            position: relative;
            aspect-ratio: 1;
        }
        .admin-image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            border: 3px solid #f2c94c;
        }
        .admin-remove-img {
            position: absolute;
            top: -8px; right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }
        .admin-product-list {
            background: #2d2d2d;
            border-radius: 30px;
            padding: 1.5rem;
        }
        .admin-product-item {
            background: #3d3d3d;
            border-radius: 20px;
            padding: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
            border-left: 6px solid #f2c94c;
        }
        .admin-product-item img {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            border: 3px solid #f2c94c;
            object-fit: cover;
        }
        .admin-product-info {
            flex: 2;
            min-width: 200px;
        }
        .admin-product-info strong {
            color: #f2c94c;
            font-size: 1.2rem;
            display: block;
            margin-bottom: 0.3rem;
        }
        .admin-product-info .size-info {
            color: #aaa;
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }
        .admin-product-actions {
            display: flex;
            gap: 0.8rem;
            flex-wrap: wrap;
            margin-left: auto;
        }
        .admin-edit-btn, .admin-delete-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            min-width: 100px;
            justify-content: center;
            transition: all 0.2s;
        }
        .admin-edit-btn {
            background: #ffc107;
            color: black;
        }
        .admin-delete-btn {
            background: #dc3545;
            color: white;
        }
        .mode-indicator {
            display: inline-block;
            padding: 0.5rem 1.5rem;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 700;
            background: #ffc107;
            color: black;
        }
        .camera-preview {
            width: 100%;
            border-radius: 20px;
            border: 4px solid #f2c94c;
            margin: 1rem 0;
        }
        .coupon-item {
            background: #3d3d3d;
            border-radius: 20px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .coupon-code {
            font-family: monospace;
            font-weight: 700;
            color: #f2c94c;
            font-size: 1.1rem;
        }
        .coupon-status {
            padding: 0.4rem 1rem;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        .status-active {
            background: #28a745;
            color: white;
        }
        .status-inactive {
            background: #dc3545;
            color: white;
        }
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
            grid-column: 1/-1;
        }
        .empty-state i {
            font-size: 4rem;
            color: #f2c94c;
            margin-bottom: 1rem;
        }
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .empty-state p {
            font-size: 1rem;
        }
        .image-link-row {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .image-link-row input {
            flex: 1;
            padding: 0.9rem 1rem;
            background: #3d3d3d;
            border: 2px solid #5a5a5a;
            border-radius: 30px;
            color: white;
        }
        .image-link-row button {
            background: #f2c94c;
            border: none;
            border-radius: 30px;
            padding: 0 2rem;
            font-weight: bold;
            cursor: pointer;
        }
        .sync-status {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        .loading-spinner {
            text-align: center;
            padding: 2rem;
            color: #f2c94c;
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <!-- POPUP BANNER -->
    <div class="popup-banner" id="popupBanner">
        <span id="popupMessage"></span>
        <span class="close-popup" id="closePopup">&times;</span>
    </div>

    <header class="header">
        <div class="logo">
            <i class="fas fa-shoe-prints"></i>
            <span>SOLE MATES</span>
        </div>
        <div style="display: flex; align-items: center;">
            <span class="sync-status" id="syncStatus">LIVE SYNC</span>
            <div class="cart-stack" id="cartToggle">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count" id="cartCount">0</span>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="tagline-section">
            <div class="main-tagline">ðŸ‘Ÿ Walk the Extra Mile in Style</div>
            <div class="sub-tagline">Premium Footwear for the Modern Soul</div>
        </div>

        <div class="offer-ribbon" id="offerRibbon">
            <i class="fas fa-truck"></i> FREE DELIVERY ON ORDERS ABOVE â‚¹499 | Pickup Available
        </div>

        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search shoes by name..." onkeyup="searchProducts()">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <h2 style="margin-bottom: 0.8rem;">ðŸ‘Ÿ new arrivals</h2>
        
        <div class="product-grid-wrapper">
            <div class="product-grid-bg"></div>
            <div class="product-grid" id="productGrid">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i> Loading products...
                </div>
            </div>
        </div>
    </main>

    <!-- PRODUCT DETAIL MODAL (UPDATED WITH SIZE SELECTION, QUANTITY CONTROLS, ADDRESS) -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <div class="modal-grid">
                <div class="modal-images">
                    <div class="main-image-container" id="mainImageContainer">
                        <img id="modalMainImage" class="main-image" src="" alt="Product">
                        <div class="zoom-hint"><i class="fas fa-search-plus"></i> Click to zoom</div>
                    </div>
                    <div class="thumbnail-grid" id="thumbnailGrid"></div>
                    
                    <!-- Size Selection Below Images -->
                    <div class="size-selection">
                        <div class="size-title">
                            <span>Select Size (Available: <span id="availableSizesCount">0</span>)</span>
                            <span id="selectedSizeDisplay" style="color:#f2c94c;">Not selected</span>
                        </div>
                        <div class="size-buttons" id="sizeButtons"></div>
                    </div>
                </div>
                
                <div class="modal-info">
                    <h2 class="modal-title" id="modalTitle"></h2>
                    <div class="rating-section">
                        <div class="stars" id="modalStars"></div>
                        <span class="rating-text" id="averageRating"></span>
                    </div>
                    <div class="price-section">
                        <span class="modal-price" id="modalPrice"></span>
                        <span class="original-price" id="modalOriginalPrice"></span>
                    </div>
                    <p class="modal-description" id="modalDescription"></p>
                    
                    <!-- Quantity Selector -->
                    <div class="quantity-selector">
                        <span>Quantity:</span>
                        <div class="quantity-controls">
                            <button class="quantity-btn" onclick="changeModalQuantity(-1)">âˆ’</button>
                            <span class="quantity-display" id="modalQuantity">1</span>
                            <button class="quantity-btn" onclick="changeModalQuantity(1)">+</button>
                        </div>
                    </div>
                    
                    <div class="coupon-section">
                        <strong>Have a coupon?</strong>
                        <div class="coupon-input">
                            <input type="text" id="couponCode" placeholder="Enter code">
                            <button onclick="applyCoupon()">Apply</button>
                        </div>
                        <div id="couponMessage" style="font-size:0.8rem;"></div>
                    </div>
                    
                    <div class="delivery-options">
                        <strong>Delivery Method:</strong>
                        <label class="delivery-option">
                            <input type="checkbox" id="pickupCheckbox" onchange="updateModalDelivery()">
                            <span>âœ“ I will pick up from store (Free)</span>
                        </label>
                    </div>
                    
                    <!-- Address Section with Location Detection -->
                    <div class="address-section">
                        <strong>Delivery Address:</strong>
                        <textarea id="modalDeliveryAddress" class="address-input" rows="2" placeholder="Enter your full address..."></textarea>
                        <button class="detect-location-btn" onclick="detectLocation('modalDeliveryAddress')">
                            <i class="fas fa-map-marker-alt"></i> Detect My Location
                        </button>
                        <div class="delivery-fee-note" id="modalDeliveryFeeNote">Standard delivery: â‚¹49 under â‚¹499, free above</div>
                    </div>
                    
                    <div class="comments-section">
                        <div class="comments-header">
                            <h3>Customer Reviews</h3>
                            <span id="reviewCount"></span>
                        </div>
                        <div class="comments-list" id="commentsList"></div>
                        <div class="comment-input">
                            <div class="comment-row"><input type="text" id="commentName" placeholder="Your name" value="Guest"></div>
                            <div class="rating-input" id="ratingInput">
                                <span data-rating="1">â˜†</span><span data-rating="2">â˜†</span><span data-rating="3">â˜†</span><span data-rating="4">â˜†</span><span data-rating="5">â˜†</span>
                            </div>
                            <div class="comment-row"><input type="text" id="commentText" placeholder="Write review..."></div>
                            <div class="comment-actions"><button onclick="addComment()"><i class="fas fa-paper-plane"></i> Post Review</button></div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="modal-add-btn" id="modalAddToCart"><i class="fas fa-cart-plus"></i> Add to Cart</button>
                        <button class="modal-buy-btn" id="modalBuyNow"><i class="fab fa-whatsapp"></i> Buy Now</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CART SIDEBAR (UPDATED WITH QUANTITY CONTROLS AND SIZE DISPLAY) -->
    <div class="cart-overlay" id="cartOverlay">
        <div class="cart-panel">
            <div class="cart-header"><h2>your cart</h2><span class="close-cart" id="closeCartBtn">&times;</span></div>
            <div class="cart-items" id="cartItemsContainer"></div>
            
            <!-- Address Section in Cart -->
            <div class="address-section" style="margin:1rem 0;">
                <strong>Delivery Address:</strong>
                <textarea id="cartAddress" class="address-input" rows="2" placeholder="Enter your full address..."><?php echo isset($_POST['address']) ? htmlspecialchars($_POST['address']) : ''; ?></textarea>
                <button class="detect-location-btn" onclick="detectLocation('cartAddress')">
                    <i class="fas fa-map-marker-alt"></i> Detect My Location
                </button>
            </div>
            
            <div class="delivery-options" style="margin:1rem 0;">
                <label class="delivery-option">
                    <input type="checkbox" id="cartPickupCheckbox" onchange="updateCart()">
                    <span>âœ“ I will pick up from store (Free)</span>
                </label>
                <div class="delivery-fee-note" id="cartDeliveryFeeNote">Standard delivery: â‚¹49 under â‚¹499, free above</div>
            </div>
            
            <div class="cart-footer">
                <div id="freeDeliveryMsg" class="free-ship-note"></div>
                <div class="total-section">
                    <div class="total-row"><span>Subtotal:</span><span id="subtotalAmount">â‚¹0</span></div>
                    <div class="total-row" id="deliveryRow"><span>Delivery:</span><span id="deliveryAmount">â‚¹0</span></div>
                    <div class="total-row grand-total"><span>Total:</span><span id="grandTotal">â‚¹0</span></div>
                </div>
                <button class="whatsapp-checkout" id="whatsappCheckoutBtn"><i class="fab fa-whatsapp"></i> order via whatsapp</button>
                <p style="font-size:0.75rem; text-align:center;">+91 90301 75006</p>
            </div>
        </div>
    </div>

    <!-- FOOTER with admin corner -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section"><h3>SOLE MATES</h3><p>Premium footwear for every step.</p><div class="social-links"><a href="#"><i class="fab fa-facebook-f"></i></a><a href="#"><i class="fab fa-instagram"></i></a><a href="#"><i class="fab fa-twitter"></i></a><a href="#"><i class="fab fa-whatsapp"></i></a></div></div>
            <div class="footer-section"><h3>Quick Links</h3><p><a href="#">About Us</a></p><p><a href="#">Contact</a></p><p><a href="#">FAQs</a></p><p><a href="#">Shipping Policy</a></p></div>
            <div class="footer-section"><h3>Contact</h3><p><i class="fas fa-phone"></i> +91 90301 75006</p><p><i class="fas fa-envelope"></i> SMS</p><p><i class="fas fa-map-marker-alt"></i> Mahabubnagar</p></div>
        </div>
        <div class="footer-gif"><img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExOXgxZHY1c2psMG1kdWZ4d21lMnhqaXdtbmFtamo5dWpreG1kdnU0dSZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/rvnsNCtFSY9tfbQUtR/giphy.gif" class="walking-shoe-gif" alt="Walking Shoe"></div>
        <div class="copyright">&copy; 2026 SOLE MATES. All rights reserved.</div>
        <!-- admin corner -->
        <div class="admin-corner">
            <button onclick="promptAdminPassword()"><i class="fas fa-lock"></i> admin</button>
        </div>
    </footer>

    <!-- ADMIN PANEL (UPDATED WITH SIZE SELECTOR) -->
    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <div style="display: flex; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
                <h2 style="color:#f2c94c; font-size: 1.8rem;"><i class="fas fa-crown"></i> Admin Dashboard</h2>
                <span id="editModeIndicator" class="mode-indicator" style="display: none;">âœŽ Editing Mode</span>
            </div>
            <button class="close-admin" onclick="toggleAdminPanel()"><i class="fas fa-times"></i> Close Admin</button>
        </div>
        
        <div class="admin-sections-container">
            <!-- Add/Edit Product Section -->
            <div class="admin-section" id="addEditSection">
                <h3 id="formTitle"><i class="fas fa-plus-circle"></i> Add New Product</h3>
                
                <div class="admin-form-group">
                    <label>Product Name</label>
                    <input type="text" id="adminName" placeholder="e.g. AIR ZOOM MAX">
                </div>
                
                <div class="admin-form-group">
                    <label>Description</label>
                    <textarea id="adminDesc" rows="3" placeholder="Describe the product features..."></textarea>
                </div>
                
                <div class="admin-form-group">
                    <label>Price (â‚¹)</label>
                    <input type="number" id="adminPrice" placeholder="599">
                </div>
                
                <!-- Size Selection for Admin (6-10) -->
                <div class="admin-form-group">
                    <label>Available Sizes (6-10) - Select multiple</label>
                    <div class="size-selector-grid" id="adminSizeSelector">
                        <label class="size-checkbox"><input type="checkbox" value="6"> <span>6</span></label>
                        <label class="size-checkbox"><input type="checkbox" value="7"> <span>7</span></label>
                        <label class="size-checkbox"><input type="checkbox" value="8"> <span>8</span></label>
                        <label class="size-checkbox"><input type="checkbox" value="9"> <span>9</span></label>
                        <label class="size-checkbox"><input type="checkbox" value="10"> <span>10</span></label>
                    </div>
                </div>
                
                <!-- Image Link Input -->
                <div class="admin-form-group">
                    <label>Add Image Links (paste any image URL)</label>
                    <div class="image-link-row">
                        <input type="url" id="imageLinkInput" placeholder="https://example.com/shoe.jpg">
                        <button id="addImageLinkBtn" class="admin-btn"><i class="fas fa-link"></i> Add</button>
                    </div>
                    <div id="adminImageGrid" class="admin-image-grid"></div>
                    <small style="color:#aaa;">Images appear instantly. Click âœ– to remove.</small>
                </div>
                
                <div class="admin-button-group" style="margin-top: 1.5rem;">
                    <button class="admin-btn-success" id="adminPublishBtn" style="flex:1; padding: 1rem;"><i class="fas fa-cloud-upload-alt"></i> PUBLISH PRODUCT</button>
                    <button class="admin-btn-warning" id="adminUpdateBtn" style="flex:1; padding: 1rem; display:none;"><i class="fas fa-save"></i> UPDATE PRODUCT</button>
                </div>
                <button class="admin-btn-warning" id="adminCancelEdit" style="display:none; margin-top:0.5rem;"><i class="fas fa-times"></i> Cancel Edit</button>
            </div>
            
            <!-- Discounts & Popup Controls -->
            <div class="admin-section">
                <h3><i class="fas fa-percent"></i> Discounts & Popup Controls</h3>
                <div class="admin-form-group">
                    <label>Global Discount (%)</label>
                    <input type="number" id="globalDiscountInput" placeholder="e.g. 20" min="0" max="100">
                </div>
                <button class="admin-btn-success" id="applyGlobalDiscountBtn" style="width: 100%; padding: 1rem;"><i class="fas fa-check-circle"></i> APPLY TO ALL PRODUCTS</button>
                <div style="margin: 1.5rem 0; border-top: 1px solid #444;"></div>
                <div class="admin-form-group">
                    <label>Popup Banner Message</label>
                    <textarea id="popupMessageInput" rows="2" placeholder="ðŸ”¥ FLASH SALE: 20% OFF EVERYTHING!"></textarea>
                </div>
                <div class="admin-button-group">
                    <button class="admin-btn" id="enablePopupBtn" style="flex:1;"><i class="fas fa-bullhorn"></i> ENABLE POPUP</button>
                    <button class="admin-btn-danger" id="disablePopupBtn" style="flex:1;"><i class="fas fa-ban"></i> DISABLE POPUP</button>
                </div>
            </div>
            
            <!-- Coupon Generator Section -->
            <div class="admin-section">
                <h3><i class="fas fa-ticket-alt"></i> Coupon Generator</h3>
                <div class="admin-form-group">
                    <label>Coupon Code</label>
                    <input type="text" id="couponCodeInput" placeholder="e.g. SAVE20">
                </div>
                <div class="admin-form-group">
                    <label>Discount (%)</label>
                    <input type="number" id="couponDiscInput" placeholder="20" min="1" max="100">
                </div>
                <button class="admin-btn-success" id="generateCouponBtn" style="width: 100%; padding: 1rem;"><i class="fas fa-plus-circle"></i> GENERATE COUPON</button>
                <div id="adminCouponList" style="margin-top: 1.5rem;"></div>
            </div>
            
            <!-- Existing Products List -->
            <div class="admin-product-list">
                <h3 style="color:#f2c94c; font-size: 1.4rem; margin-bottom: 1.5rem;"><i class="fas fa-boxes"></i> Existing Products</h3>
                <div id="adminProductsContainer"></div>
                <div class="admin-button-group" style="margin-top: 2rem;">
                    <button class="admin-btn-danger" id="clearAllProductsBtn" style="flex:1; padding: 1rem;"><i class="fas fa-exclamation-triangle"></i> DELETE ALL PRODUCTS</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== FIREBASE CONFIGURATION ==========
        const firebaseConfig = {
            apiKey: "AIzaSyAFriEYS22Pmw-Za9IrJ9eC6cOqU5FVBKs",
            authDomain: "solemate-289f0.firebaseapp.com",
            databaseURL: "https://solemate-289f0-default-rtdb.firebaseio.com",
            projectId: "solemate-289f0",
            storageBucket: "solemate-289f0.firebasestorage.app",
            messagingSenderId: "548256172024",
            appId: "1:548256172024:web:158f0aec07df5347ccb80d",
            measurementId: "G-X32CQWH3SB"
        };

        // ========== INITIALIZE FIREBASE ==========
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log("âœ… Firebase connected successfully!");
            document.getElementById('syncStatus').textContent = 'LIVE';
            document.getElementById('syncStatus').style.background = '#28a745';
        } catch (error) {
            console.error("âŒ Firebase connection failed:", error);
            document.getElementById('syncStatus').textContent = 'OFFLINE';
            document.getElementById('syncStatus').style.background = '#dc3545';
            database = null;
        }

        // ========== GLOBAL DATA ==========
        let products = [];
        let cart = JSON.parse(localStorage.getItem('solemates_cart')) || [];
        let comments = {};
        let ratings = {};
        let coupons = [];
        let currentProduct = null;
        let zoomed = false;
        let selectedRating = 0;
        let appliedCoupon = null;
        let currentModalQuantity = 1;
        let selectedSize = null;
        
        // Global address storage - persists across modal and cart
        let userAddress = localStorage.getItem('solemates_address') || '';
        
        const WHATSAPP_NUMBER = '919030175006';
        const DELIVERY_FEE = 49;
        const ADMIN_PASSWORD = 'mustafa006';

        // ========== FIREBASE SYNC FUNCTIONS ==========
        function loadFromFirebase() {
            if (!database) {
                console.log("âš ï¸ Using localStorage fallback");
                products = JSON.parse(localStorage.getItem('solemates_products')) || [];
                comments = JSON.parse(localStorage.getItem('solemates_comments')) || {};
                ratings = JSON.parse(localStorage.getItem('solemates_ratings')) || {};
                coupons = JSON.parse(localStorage.getItem('solemates_coupons')) || [];
                renderProducts();
                return;
            }

            document.getElementById('productGrid').innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading products...</div>';

            firebase.database().ref('products').on('value', (snapshot) => {
                const data = snapshot.val();
                products = data ? Object.values(data) : [];
                console.log("ðŸ“¦ Products loaded:", products.length);
                localStorage.setItem('solemates_products', JSON.stringify(products));
                renderProducts();
                
                if (document.getElementById('adminPanel').style.display === 'block') {
                    renderAdminProducts();
                }
            }, (error) => {
                console.error("Firebase read error:", error);
                products = JSON.parse(localStorage.getItem('solemates_products')) || [];
                renderProducts();
            });

            firebase.database().ref('comments').on('value', (snapshot) => {
                comments = snapshot.val() || {};
                localStorage.setItem('solemates_comments', JSON.stringify(comments));
            });

            firebase.database().ref('ratings').on('value', (snapshot) => {
                ratings = snapshot.val() || {};
                localStorage.setItem('solemates_ratings', JSON.stringify(ratings));
            });

            firebase.database().ref('coupons').on('value', (snapshot) => {
                coupons = snapshot.val() || [];
                localStorage.setItem('solemates_coupons', JSON.stringify(coupons));
            });

            firebase.database().ref('popup').on('value', (snapshot) => {
                const popupData = snapshot.val();
                if (popupData) {
                    localStorage.setItem('solemates_popup', JSON.stringify(popupData));
                    loadPopup();
                }
            });
        }

        function saveToFirebase(path, data) {
            if (!database) {
                localStorage.setItem(`solemates_${path}`, JSON.stringify(data));
                console.log("ðŸ’¾ Saved to localStorage:", path);
                return;
            }
            
            const syncStatus = document.getElementById('syncStatus');
            syncStatus.textContent = 'SAVING...';
            syncStatus.style.background = '#ffc107';
            
            firebase.database().ref(path).set(data)
                .then(() => {
                    console.log("âœ… Saved to Firebase:", path);
                    syncStatus.textContent = 'LIVE';
                    syncStatus.style.background = '#28a745';
                })
                .catch((error) => {
                    console.error("âŒ Firebase save error:", error);
                    syncStatus.textContent = 'ERROR';
                    syncStatus.style.background = '#dc3545';
                    localStorage.setItem(`solemates_${path}`, JSON.stringify(data));
                    
                    setTimeout(() => {
                        syncStatus.textContent = 'LIVE';
                        syncStatus.style.background = '#28a745';
                    }, 2000);
                });
        }

        // ========== ADDRESS MANAGEMENT ==========
        function updateAddress(address, source) {
            userAddress = address;
            localStorage.setItem('solemates_address', userAddress);
            
            // Update all address fields
            const modalAddress = document.getElementById('modalDeliveryAddress');
            const cartAddress = document.getElementById('cartAddress');
            
            if (modalAddress) modalAddress.value = userAddress;
            if (cartAddress) cartAddress.value = userAddress;
        }

        // ========== SEARCH FUNCTION ==========
        window.searchProducts = function() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            renderProducts(searchTerm);
        };

        // ========== HELPER FUNCTIONS ==========
        function isNew(p) { 
            if (!p || !p.date) return false;
            return (new Date() - new Date(p.date)) / 86400000 <= 7; 
        }
        
        function getDiscountedPrice(p) { 
            let price = p.discount ? Math.round(p.price * (1 - p.discount/100)) : p.price;
            if (appliedCoupon) {
                price = Math.round(price * (1 - appliedCoupon.discount/100));
            }
            return price;
        }

        // ========== RENDER PRODUCT GRID ==========
        function renderProducts(searchTerm = '') {
            const productGrid = document.getElementById('productGrid');
            
            let filteredProducts = products;
            if (searchTerm) {
                filteredProducts = products.filter(p => 
                    p.name && p.name.toLowerCase().includes(searchTerm)
                );
            }
            
            if (!filteredProducts || filteredProducts.length === 0) {
                productGrid.innerHTML = '<div class="empty-state"><i class="fas fa-shoe-prints"></i><h3>No Products Found</h3><p>' + 
                    (searchTerm ? 'Try a different search term' : 'Admin can add products from the admin panel') + 
                    '</p></div>';
                return;
            }
            
            productGrid.innerHTML = '';
            
            filteredProducts.forEach(prod => {
                if (!prod || !prod.id) return;
                
                const dPrice = getDiscountedPrice(prod);
                const hasDiscount = prod.discount > 0;
                const sizes = prod.sizes || [];
                
                const card = document.createElement('div');
                card.className = 'product-card';
                card.setAttribute('onclick', `openProductModal('${prod.id}')`);
                
                let badges = '';
                if (isNew(prod)) badges += '<span class="new-badge">ðŸ”¥ NEW</span>';
                if (hasDiscount) badges += `<span class="discount-badge">-${prod.discount}%</span>`;
                if (sizes.length > 0) badges += `<span class="size-badge">ðŸ“ ${sizes.join(', ')}</span>`;
                
                const imageUrl = prod.images && prod.images.length > 0 ? prod.images[0] : 'https://via.placeholder.com/200?text=No+Image';
                
                card.innerHTML = `
                    ${badges}
                    <img src="${imageUrl}" class="product-image" onerror="this.src='https://via.placeholder.com/200?text=No+Image'">
                    <div class="product-name">${prod.name || 'Unnamed'}</div>
                    <div class="product-description">${(prod.description || '').substring(0, 25)}...</div>
                    <div class="product-price">
                        ${hasDiscount ? `<span class="original-price">â‚¹${prod.price}</span>` : ''} 
                        â‚¹${dPrice}
                    </div>
                    <div class="product-actions">
                        <button class="add-btn" onclick="event.stopPropagation(); addToCart('${prod.id}')">
                            <i class="fas fa-cart-plus"></i> add
                        </button>
                        <button class="buy-btn" onclick="event.stopPropagation(); buyNow('${prod.id}')">
                            <i class="fab fa-whatsapp"></i> buy
                        </button>
                    </div>
                `;
                productGrid.appendChild(card);
            });
        }

        // ========== BUY NOW FUNCTION ==========
        window.buyNow = function(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Open modal first
            openProductModal(productId);
            
            // Then trigger buy after a short delay
            setTimeout(() => {
                document.getElementById('modalBuyNow').click();
            }, 500);
        };

        // ========== LOCATION DETECTION ==========
        window.detectLocation = function(textareaId) {
            if (!navigator.geolocation) { 
                alert('Geolocation not supported'); 
                return; 
            }
            
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;
                    
                    // Use reverse geocoding to get address
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`)
                        .then(response => response.json())
                        .then(data => {
                            const address = data.display_name || `${lat}, ${lng}`;
                            document.getElementById(textareaId).value = address;
                            
                            // Update global address
                            updateAddress(address, textareaId);
                        })
                        .catch(() => {
                            // Fallback to coordinates
                            const address = `Location: ${lat}, ${lng}`;
                            document.getElementById(textareaId).value = address;
                            updateAddress(address, textareaId);
                        });
                },
                (error) => {
                    alert('Could not detect location. Please enter manually.');
                    console.error('Geolocation error:', error);
                }
            );
        };

        // ========== CART FUNCTIONS ==========
        window.addToCart = function(productId, size = null, quantity = 1) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // If no size provided and product has sizes, check if size is selected
            if (!size && product.sizes && product.sizes.length > 0) {
                alert('Please select a size first');
                return;
            }
            
            // Calculate price with all discounts
            let price = getDiscountedPrice(product);
            
            // Create unique ID with size
            const cartItemId = size ? `${product.id}-${size}` : product.id;
            
            const existing = cart.find(i => i.id === cartItemId);
            if (existing) {
                existing.quantity += quantity;
            } else {
                cart.push({
                    id: cartItemId,
                    productId: product.id,
                    name: product.name,
                    price: price,
                    originalPrice: product.price,
                    size: size,
                    quantity: quantity,
                    images: product.images
                });
            }
            
            updateCart();
            
            // Show cart briefly
            document.getElementById('cartOverlay').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('cartOverlay').style.display = 'none';
            }, 2000);
        };
        
        window.removeFromCart = function(id) { 
            cart = cart.filter(i => i.id !== id); 
            updateCart(); 
        };
        
        window.updateCartQuantity = function(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== id);
                }
                updateCart();
            }
        };

        function updateCart() {
            localStorage.setItem('solemates_cart', JSON.stringify(cart));
            document.getElementById('cartCount').textContent = cart.reduce((a, i) => a + (i.quantity || 0), 0);
            renderCartSidebar();
        }
        
        function renderCartSidebar() {
            const cartItemsContainer = document.getElementById('cartItemsContainer');
            cartItemsContainer.innerHTML = '';
            
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p style="padding:1.5rem; text-align:center;">cart empty</p>';
            } else {
                cart.forEach(i => {
                    const item = document.createElement('div'); 
                    item.className = 'cart-item';
                    const imageUrl = i.images && i.images.length > 0 ? i.images[0] : 'https://via.placeholder.com/60';
                    item.innerHTML = `
                        <img src="${imageUrl}" class="cart-item-image" onerror="this.src='https://via.placeholder.com/60'">
                        <div class="cart-item-info">
                            <strong>${i.name || 'Shoe'}</strong>
                            ${i.size ? `<div class="cart-item-size">Size: ${i.size}</div>` : ''}
                            <div class="cart-item-quantity">
                                <button class="cart-qty-btn" onclick="updateCartQuantity('${i.id}', -1)">âˆ’</button>
                                <span>${i.quantity || 0}</span>
                                <button class="cart-qty-btn" onclick="updateCartQuantity('${i.id}', 1)">+</button>
                            </div>
                        </div>
                        <div>â‚¹${(i.price || 0) * (i.quantity || 0)}</div>
                        <button class="remove-item" onclick="removeFromCart('${i.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    cartItemsContainer.appendChild(item);
                });
            }
            
            const subtotal = cart.reduce((s, i) => s + ((i.price || 0) * (i.quantity || 0)), 0);
            const cartPickupCheckbox = document.getElementById('cartPickupCheckbox');
            const isPickup = cartPickupCheckbox && cartPickupCheckbox.checked;
            
            let delivery = isPickup ? 0 : (subtotal < 499 ? DELIVERY_FEE : 0);
            
            document.getElementById('subtotalAmount').textContent = `â‚¹${subtotal}`;
            document.getElementById('deliveryAmount').textContent = delivery > 0 ? `â‚¹${delivery}` : 'Free';
            document.getElementById('grandTotal').textContent = `â‚¹${subtotal + delivery}`;
            document.getElementById('freeDeliveryMsg').innerHTML = isPickup ? 
                'âœ… store pickup' : 
                (subtotal >= 499 ? 'âœ… FREE DELIVERY' : `ðŸ›’ add â‚¹${499 - subtotal} more for free delivery`);
        }

        // ========== MODAL FUNCTIONS ==========
        window.openProductModal = function(id) {
            const p = products.find(p => p.id === id); 
            if (!p) return;
            
            currentProduct = p; 
            currentModalQuantity = 1;
            selectedSize = null;
            document.getElementById('modalQuantity').textContent = '1';
            document.getElementById('selectedSizeDisplay').textContent = 'Not selected';
            
            // Load saved address
            const modalAddress = document.getElementById('modalDeliveryAddress');
            if (modalAddress) modalAddress.value = userAddress;
            
            // Calculate price with all discounts
            let dPrice = getDiscountedPrice(p); 
            
            document.getElementById('modalTitle').textContent = p.name || 'Product'; 
            document.getElementById('modalDescription').textContent = p.description || 'No description'; 
            document.getElementById('modalPrice').textContent = `â‚¹${dPrice}`;
            
            if (p.discount) { 
                document.getElementById('modalOriginalPrice').textContent = `â‚¹${p.price}`; 
                document.getElementById('modalOriginalPrice').style.display = 'inline'; 
            } else {
                document.getElementById('modalOriginalPrice').style.display = 'none';
            }
            
            document.getElementById('modalMainImage').src = (p.images && p.images.length > 0) ? p.images[0] : ''; 
            
            // Render thumbnails
            const thumbnailGrid = document.getElementById('thumbnailGrid');
            thumbnailGrid.innerHTML = '';
            
            if (p.images && p.images.length > 0) {
                p.images.forEach((img, i) => { 
                    let t = document.createElement('img'); 
                    t.src = img; 
                    t.className = `thumbnail ${i === 0 ? 'active' : ''}`; 
                    t.onclick = () => { 
                        document.getElementById('modalMainImage').src = img; 
                        document.querySelectorAll('.thumbnail').forEach(th => th.classList.remove('active')); 
                        t.classList.add('active'); 
                    }; 
                    thumbnailGrid.appendChild(t); 
                });
            }
            
            // Render size buttons
            renderSizeButtons();
            
            loadRatings(id); 
            loadComments(id); 
            document.getElementById('productModal').style.display = 'block'; 
            document.body.style.overflow = 'hidden';
        };
        
        function renderSizeButtons() {
            const sizeButtons = document.getElementById('sizeButtons');
            const availableSizes = currentProduct.sizes || [];
            document.getElementById('availableSizesCount').textContent = availableSizes.length;
            
            sizeButtons.innerHTML = '';
            
            if (availableSizes.length === 0) {
                sizeButtons.innerHTML = '<p style="color:#666;">No sizes available</p>';
                return;
            }
            
            // Show sizes 6-10, but only enable those that are available
            for (let size = 6; size <= 10; size++) {
                const btn = document.createElement('button');
                btn.className = 'size-btn';
                btn.textContent = size;
                
                if (availableSizes.includes(size.toString())) {
                    btn.onclick = () => selectSize(size.toString());
                } else {
                    btn.classList.add('disabled');
                }
                
                sizeButtons.appendChild(btn);
            }
        }
        
        function selectSize(size) {
            selectedSize = size;
            document.getElementById('selectedSizeDisplay').textContent = `Size ${size}`;
            
            // Update all size buttons to show selected state
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent === size) {
                    btn.classList.add('selected');
                }
            });
        }
        
        window.changeModalQuantity = function(change) {
            const newQty = currentModalQuantity + change;
            if (newQty >= 1 && newQty <= 10) {
                currentModalQuantity = newQty;
                document.getElementById('modalQuantity').textContent = newQty;
            }
        };
        
        function updateModalDelivery() {
            updateCart(); // Reuse cart update logic
        }
        
        function loadRatings(id) { 
            let r = (ratings && ratings[id]) || []; 
            let avg = r.length ? (r.reduce((a, b) => a + (b.rating || 0), 0) / r.length).toFixed(1) : 0; 
            document.getElementById('averageRating').textContent = `(${avg} avg, ${r.length} reviews)`; 
            document.getElementById('reviewCount').textContent = `(${r.length})`; 
        }
        
        function loadComments(id) { 
            let c = (comments && comments[id]) || []; 
            const commentsList = document.getElementById('commentsList');
            commentsList.innerHTML = ''; 
            
            if (c.length === 0) {
                commentsList.innerHTML = '<div class="no-reviews">No reviews yet.</div>';
            } else {
                c.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(cmt => { 
                    let d = document.createElement('div'); 
                    d.className = 'comment-item'; 
                    let stars = '';
                    for (let i = 0; i < 5; i++) {
                        stars += i < cmt.rating ? 'â˜…' : 'â˜†';
                    }
                    d.innerHTML = `
                        <div class="comment-header">
                            <span class="comment-author">${cmt.author || 'Anonymous'}</span>
                            <span class="comment-rating">${stars}</span>
                        </div>
                        <p class="comment-text">${cmt.text || ''}</p>
                        <div class="comment-date">${new Date(cmt.date).toLocaleDateString()}</div>
                    `; 
                    commentsList.appendChild(d); 
                });
            }
        }

        window.addComment = function() {
            let name = document.getElementById('commentName').value.trim() || 'Guest';
            let text = document.getElementById('commentText').value.trim();
            
            if (!text || selectedRating === 0) {
                alert('Please write a review and select a rating');
                return;
            }
            
            if (!currentProduct || !currentProduct.id) {
                alert('No product selected');
                return;
            }
            
            const productId = currentProduct.id;
            
            if (!comments[productId]) comments[productId] = [];
            if (!ratings[productId]) ratings[productId] = [];
            
            comments[productId].push({ 
                author: name, 
                text, 
                rating: selectedRating, 
                date: new Date().toISOString() 
            });
            
            ratings[productId].push({ 
                rating: selectedRating, 
                date: new Date().toISOString() 
            });
            
            saveToFirebase('comments', comments);
            saveToFirebase('ratings', ratings);
            
            document.getElementById('commentText').value = ''; 
            selectedRating = 0; 
            updateRatingInput(); 
            
            loadComments(productId); 
            loadRatings(productId);
        };
        
        function updateRatingInput() { 
            document.querySelectorAll('#ratingInput span').forEach((s, i) => { 
                s.innerHTML = i < selectedRating ? 'â˜…' : 'â˜†'; 
                s.style.color = i < selectedRating ? '#f2c94c' : '#ccc'; 
            }); 
        }
        
        document.querySelectorAll('#ratingInput span').forEach(s => {
            s.addEventListener('click', function() { 
                selectedRating = parseInt(this.dataset.rating); 
                updateRatingInput(); 
            });
        });

        document.getElementById('mainImageContainer').addEventListener('click', function() { 
            zoomed = !zoomed; 
            document.getElementById('modalMainImage').classList.toggle('zoomed', zoomed); 
        });
        
        // Modal add to cart
        document.getElementById('modalAddToCart').addEventListener('click', () => { 
            if (!currentProduct) return;
            
            // Check if size needs to be selected
            if (currentProduct.sizes && currentProduct.sizes.length > 0 && !selectedSize) {
                alert('Please select a size');
                return;
            }
            
            // Update address from modal before adding to cart
            const modalAddress = document.getElementById('modalDeliveryAddress').value.trim();
            if (modalAddress) {
                updateAddress(modalAddress, 'modal');
            }
            
            addToCart(currentProduct.id, selectedSize, currentModalQuantity); 
            document.getElementById('productModal').style.display = 'none'; 
            document.body.style.overflow = 'auto'; 
        });
        
        // Modal buy now
        document.getElementById('modalBuyNow').addEventListener('click', () => {
            if (!currentProduct) return;
            
            // Check if size needs to be selected
            if (currentProduct.sizes && currentProduct.sizes.length > 0 && !selectedSize) {
                alert('Please select a size');
                return;
            }
            
            // Update address from modal
            const modalAddress = document.getElementById('modalDeliveryAddress').value.trim();
            if (modalAddress) {
                updateAddress(modalAddress, 'modal');
            }
            
            const address = userAddress || document.getElementById('modalDeliveryAddress').value.trim();
            if (!address) {
                alert('Please enter your delivery address');
                return;
            }
            
            const price = getDiscountedPrice(currentProduct);
            const total = price * currentModalQuantity;
            const isPickup = document.getElementById('pickupCheckbox').checked;
            const delivery = isPickup ? 0 : (total < 499 ? DELIVERY_FEE : 0);
            const grandTotal = total + delivery;
            
            let msg = `*New Order from SOLE MATES*%0A%0A`;
            msg += `*Product:* ${currentProduct.name}%0A`;
            if (selectedSize) msg += `*Size:* ${selectedSize}%0A`;
            msg += `*Quantity:* ${currentModalQuantity}%0A`;
            msg += `*Price per piece:* â‚¹${price}%0A`;
            msg += `*Subtotal:* â‚¹${total}%0A`;
            msg += `*Delivery:* ${isPickup ? 'Store Pickup (Free)' : (delivery > 0 ? 'â‚¹' + delivery : 'Free')}%0A`;
            msg += `*Grand Total:* â‚¹${grandTotal}%0A%0A`;
            msg += `*Delivery Address:* ${address}%0A%0A`;
            msg += `ðŸ›ï¸ Thank you for shopping with us!`;
            
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, '_blank');
        });
        
        // WhatsApp checkout from cart
        document.getElementById('whatsappCheckoutBtn').addEventListener('click', () => {
            if (!cart.length) { 
                alert('Cart empty'); 
                return; 
            }
            
            // Update address from cart
            const cartAddress = document.getElementById('cartAddress').value.trim();
            if (cartAddress) {
                updateAddress(cartAddress, 'cart');
            }
            
            const address = userAddress || document.getElementById('cartAddress').value.trim();
            if (!address) {
                alert('Please enter your delivery address');
                return;
            }
            
            const subtotal = cart.reduce((s, i) => s + ((i.price || 0) * (i.quantity || 0)), 0);
            const isPickup = document.getElementById('cartPickupCheckbox').checked;
            const delivery = isPickup ? 0 : (subtotal < 499 ? DELIVERY_FEE : 0);
            const total = subtotal + delivery;
            
            let orderItems = cart.map(i => {
                let item = `${i.name} - ${i.quantity} x â‚¹${i.price} = â‚¹${(i.price || 0) * (i.quantity || 0)}`;
                if (i.size) item += ` (Size: ${i.size})`;
                return item;
            }).join('%0A');
            
            let msg = `*New Order from SOLE MATES*%0A%0A`;
            msg += `${orderItems}%0A%0A`;
            msg += `*Subtotal: â‚¹${subtotal}*%0A`;
            msg += `${isPickup ? 'Store Pickup' : delivery > 0 ? 'Delivery: â‚¹' + delivery : 'Delivery: Free'}%0A`;
            msg += `*Grand Total: â‚¹${total}*%0A%0A`;
            msg += `*Delivery Address:* ${address}%0A%0A`;
            msg += `ðŸ›ï¸ Thank you for shopping with us!`;
            
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`, '_blank');
        });
        
        window.applyCoupon = function() {
            let code = document.getElementById('couponCode').value.trim().toUpperCase();
            let c = coupons.find(c => c && c.code === code && c.active);
            
            if (c) { 
                appliedCoupon = c; 
                document.getElementById('couponMessage').innerHTML = `âœ… Coupon applied! ${c.discount}% off`; 
                if (currentProduct) {
                    let price = getDiscountedPrice(currentProduct);
                    document.getElementById('modalPrice').textContent = `â‚¹${price}`; 
                }
                updateCart(); 
            } else { 
                appliedCoupon = null; 
                document.getElementById('couponMessage').innerHTML = 'âŒ Invalid coupon'; 
                updateCart(); 
            }
        };
        
        function loadPopup() {
            let pd = localStorage.getItem('solemates_popup');
            if (pd) { 
                try {
                    let {message, enabled} = JSON.parse(pd); 
                    if (enabled && message) { 
                        document.getElementById('popupMessage').textContent = message; 
                        document.getElementById('popupBanner').style.display = 'block'; 
                    } else {
                        document.getElementById('popupBanner').style.display = 'none'; 
                    }
                } catch (e) {
                    document.getElementById('popupBanner').style.display = 'none';
                }
            } else {
                document.getElementById('popupBanner').style.display = 'none';
            }
        }
        
        document.getElementById('closePopup').addEventListener('click', () => {
            document.getElementById('popupBanner').style.display = 'none';
        });

        // Event listeners
        document.getElementById('cartToggle').addEventListener('click', () => { 
            renderCartSidebar(); 
            document.getElementById('cartOverlay').style.display = 'flex'; 
        });
        
        document.getElementById('closeCartBtn').addEventListener('click', () => {
            document.getElementById('cartOverlay').style.display = 'none';
        });
        
        document.getElementById('cartOverlay').addEventListener('click', e => { 
            if (e.target === document.getElementById('cartOverlay')) {
                document.getElementById('cartOverlay').style.display = 'none'; 
            }
        });
        
        document.getElementById('closeModal').addEventListener('click', () => { 
            document.getElementById('productModal').style.display = 'none'; 
            document.body.style.overflow = 'auto'; 
            zoomed = false; 
            document.getElementById('modalMainImage').classList.remove('zoomed'); 
        });
        
        document.getElementById('productModal').addEventListener('click', e => { 
            if (e.target === document.getElementById('productModal')) { 
                document.getElementById('productModal').style.display = 'none'; 
                document.body.style.overflow = 'auto'; 
                zoomed = false; 
            } 
        });
        
        document.getElementById('pickupCheckbox')?.addEventListener('change', updateCart);
        document.getElementById('cartPickupCheckbox')?.addEventListener('change', updateCart);

        // ========== ADMIN FUNCTIONS ==========
        let editingProductId = null;
        let adminImages = [];
        
        window.promptAdminPassword = function() {
            let pwd = prompt('Enter admin password:');
            if (pwd === ADMIN_PASSWORD) {
                document.getElementById('adminPanel').style.display = 'block';
                resetAdminForm();
                renderAdminProducts(); 
                renderAdminCoupons();
            } else {
                alert('Incorrect password');
            }
        };
        
        window.toggleAdminPanel = function() {
            let panel = document.getElementById('adminPanel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
            if (panel.style.display === 'block') { 
                resetAdminForm();
                renderAdminProducts(); 
                renderAdminCoupons(); 
            }
        };

        function resetAdminForm() {
            editingProductId = null;
            document.getElementById('adminName').value = '';
            document.getElementById('adminDesc').value = '';
            document.getElementById('adminPrice').value = '';
            adminImages = [];
            
            // Reset size checkboxes
            document.querySelectorAll('#adminSizeSelector input').forEach(cb => cb.checked = false);
            
            updateAdminImageGrid();
            document.getElementById('formTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Add New Product';
            document.getElementById('adminPublishBtn').style.display = 'block';
            document.getElementById('adminUpdateBtn').style.display = 'none';
            document.getElementById('adminCancelEdit').style.display = 'none';
            document.getElementById('editModeIndicator').style.display = 'none';
        }

        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            
            editingProductId = id;
            document.getElementById('adminName').value = product.name || '';
            document.getElementById('adminDesc').value = product.description || '';
            document.getElementById('adminPrice').value = product.price || '';
            adminImages = product.images ? [...product.images] : [];
            
            // Set size checkboxes
            const sizes = product.sizes || [];
            document.querySelectorAll('#adminSizeSelector input').forEach(cb => {
                cb.checked = sizes.includes(cb.value);
            });
            
            updateAdminImageGrid();
            document.getElementById('formTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Product: ' + product.name;
            document.getElementById('adminPublishBtn').style.display = 'none';
            document.getElementById('adminUpdateBtn').style.display = 'block';
            document.getElementById('adminCancelEdit').style.display = 'inline-block';
            document.getElementById('editModeIndicator').style.display = 'inline-block';
            document.getElementById('addEditSection').scrollIntoView({ behavior: 'smooth' });
        };

        document.getElementById('adminCancelEdit').addEventListener('click', resetAdminForm);

        document.getElementById('addImageLinkBtn').addEventListener('click', () => {
            let url = document.getElementById('imageLinkInput').value.trim();
            if (!url) { 
                alert('Paste an image URL'); 
                return; 
            }
            try { 
                new URL(url); 
            } catch { 
                alert('Invalid URL'); 
                return; 
            }
            adminImages.push(url);
            updateAdminImageGrid();
            document.getElementById('imageLinkInput').value = '';
        });

        function updateAdminImageGrid() {
            const adminImageGrid = document.getElementById('adminImageGrid');
            adminImageGrid.innerHTML = '';
            
            if (adminImages.length === 0) {
                adminImageGrid.innerHTML = '<p style="color:#666; text-align:center; grid-column:1/-1;">No images added yet</p>';
                return;
            }
            
            adminImages.forEach((img, i) => { 
                let d = document.createElement('div'); 
                d.className = 'admin-image-item'; 
                d.innerHTML = `<img src="${img}" onerror="this.src='https://via.placeholder.com/80?text=Error'"><button class="admin-remove-img" onclick="removeAdminImage(${i})">&times;</button>`; 
                adminImageGrid.appendChild(d); 
            });
        }
        
        window.removeAdminImage = (i) => { 
            adminImages.splice(i, 1); 
            updateAdminImageGrid(); 
        };

        // Publish new product
        document.getElementById('adminPublishBtn').addEventListener('click', () => {
            const name = document.getElementById('adminName').value.trim() || 'New Arrival';
            const desc = document.getElementById('adminDesc').value.trim() || 'Stylish footwear';
            const price = parseFloat(document.getElementById('adminPrice').value);
            
            // Get selected sizes
            const sizes = [];
            document.querySelectorAll('#adminSizeSelector input:checked').forEach(cb => {
                sizes.push(cb.value);
            });
            
            if (isNaN(price) || price <= 0) { 
                alert('Please enter a valid price'); 
                return; 
            }
            if (adminImages.length === 0) { 
                alert('Please add at least one image link'); 
                return; 
            }
            
            let id = 'SM-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            let newProd = { 
                id, 
                name, 
                description: desc, 
                price, 
                images: [...adminImages], 
                sizes: sizes,
                date: new Date().toISOString(), 
                discount: null, 
                discountCode: null 
            };
            
            products.push(newProd); 
            saveToFirebase('products', products);
            
            resetAdminForm();
            alert('âœ… Product published globally! Visible on all devices now.');
        });

        // Update existing product
        document.getElementById('adminUpdateBtn').addEventListener('click', () => {
            if (!editingProductId) return;
            
            const name = document.getElementById('adminName').value.trim() || 'New Arrival';
            const desc = document.getElementById('adminDesc').value.trim() || 'Stylish footwear';
            const price = parseFloat(document.getElementById('adminPrice').value);
            
            // Get selected sizes
            const sizes = [];
            document.querySelectorAll('#adminSizeSelector input:checked').forEach(cb => {
                sizes.push(cb.value);
            });
            
            if (isNaN(price) || price <= 0) { 
                alert('Please enter a valid price'); 
                return; 
            }
            if (adminImages.length === 0) { 
                alert('Please add at least one image link'); 
                return; 
            }

            products = products.map(p => {
                if (p.id === editingProductId) {
                    return { 
                        ...p, 
                        name, 
                        description: desc, 
                        price, 
                        images: adminImages,
                        sizes: sizes
                    };
                }
                return p;
            });

            saveToFirebase('products', products);
            
            resetAdminForm();
            alert('âœ… Product updated globally!');
        });

        // Global discount
        document.getElementById('applyGlobalDiscountBtn').addEventListener('click', () => {
            let d = parseFloat(document.getElementById('globalDiscountInput').value);
            if (isNaN(d) || d < 0 || d > 100) { 
                alert('Enter valid discount (0-100)'); 
                return; 
            }
            
            products = products.map(p => ({...p, discount: d, discountCode: null})); 
            saveToFirebase('products', products); 
            alert(`âœ… Applied ${d}% discount to all products`);
        });
        
        // Popup controls
        document.getElementById('enablePopupBtn').addEventListener('click', () => {
            let msg = document.getElementById('popupMessageInput').value.trim() || 'ðŸ”¥ FLASH SALE';
            let popupData = {message: msg, enabled: true};
            saveToFirebase('popup', popupData); 
            alert('âœ… Popup enabled globally');
        });
        
        document.getElementById('disablePopupBtn').addEventListener('click', () => {
            let popupData = {message: '', enabled: false};
            saveToFirebase('popup', popupData); 
            alert('Popup disabled');
        });
        
        // Coupon generator
        document.getElementById('generateCouponBtn').addEventListener('click', () => {
            let code = document.getElementById('couponCodeInput').value.trim().toUpperCase();
            let disc = parseInt(document.getElementById('couponDiscInput').value);
            
            if (!code || isNaN(disc) || disc < 1 || disc > 100) { 
                alert('Please enter valid code and discount (1-100)'); 
                return; 
            }
            
            coupons.push({code, discount: disc, active: true}); 
            saveToFirebase('coupons', coupons); 
            renderAdminCoupons();
            
            document.getElementById('couponCodeInput').value = '';
            document.getElementById('couponDiscInput').value = '';
            alert(`âœ… Coupon ${code} generated with ${disc}% discount`);
        });
        
        window.toggleAdminCoupon = (index) => { 
            if (!coupons[index]) return;
            coupons[index].active = !coupons[index].active; 
            saveToFirebase('coupons', coupons); 
            renderAdminCoupons(); 
        };
        
        function renderAdminCoupons() {
            let cont = document.getElementById('adminCouponList'); 
            cont.innerHTML = '<h4 style="color:#f2c94c; margin-bottom:1rem;">Active Coupons</h4>';
            
            if (!coupons || coupons.length === 0) {
                cont.innerHTML += '<p style="color:#666; padding:1rem; background:#3d3d3d; border-radius:20px;">No coupons generated yet.</p>';
                return;
            }
            
            coupons.forEach((c, i) => { 
                if (!c) return;
                let d = document.createElement('div'); 
                d.className = 'coupon-item';
                d.innerHTML = `
                    <span class="coupon-code">${c.code || 'N/A'}</span>
                    <span style="font-weight:600;">${c.discount || 0}% off</span>
                    <span class="coupon-status ${c.active ? 'status-active' : 'status-inactive'}">${c.active ? 'ACTIVE' : 'INACTIVE'}</span>
                    <button class="admin-btn" onclick="toggleAdminCoupon(${i})" style="min-width:80px;">
                        <i class="fas fa-toggle-${c.active ? 'on' : 'off'}"></i> ${c.active ? 'Disable' : 'Enable'}
                    </button>
                `; 
                cont.appendChild(d); 
            });
        }
        
        function renderAdminProducts() {
            let cont = document.getElementById('adminProductsContainer'); 
            cont.innerHTML = '';
            
            if (!products || products.length === 0) {
                cont.innerHTML = '<p style="color:#666; text-align:center; padding:2rem; background:#3d3d3d; border-radius:20px;">No products yet. Add your first product above!</p>';
                return;
            }
            
            products.forEach(p => {
                if (!p) return;
                let d = document.createElement('div'); 
                d.className = 'admin-product-item';
                const imageUrl = p.images && p.images.length > 0 ? p.images[0] : 'https://via.placeholder.com/80';
                const sizes = p.sizes || [];
                
                d.innerHTML = `
                    <img src="${imageUrl}" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="admin-product-info">
                        <strong>${p.name || 'Unnamed'}</strong>
                        <p style="color:#ccc;">${(p.description || '').substring(0, 50)}${(p.description || '').length > 50 ? '...' : ''}</p>
                        <p style="color:#f2c94c; font-weight:700;">â‚¹${p.price || 0} ${p.discount ? `<span style="color:#ff6b6b;">(-${p.discount}%)</span>` : ''}</p>
                        ${sizes.length > 0 ? `<div class="size-info">Sizes: ${sizes.join(', ')}</div>` : ''}
                        <small style="color:#666;">ID: ${p.id || 'N/A'}</small>
                    </div>
                    <div class="admin-product-actions">
                        <button class="admin-edit-btn" onclick="editProduct('${p.id}')"><i class="fas fa-edit"></i> EDIT</button>
                        <button class="admin-delete-btn" onclick="deleteAdminProduct('${p.id}')"><i class="fas fa-trash"></i> DELETE</button>
                    </div>
                `;
                cont.appendChild(d);
            });
        }
        
        window.deleteAdminProduct = (id) => { 
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== id); 
                saveToFirebase('products', products); 
                if (editingProductId === id) resetAdminForm();
                alert('âœ… Product deleted globally');
            }
        };
        
        document.getElementById('clearAllProductsBtn').addEventListener('click', () => { 
            if (confirm('âš ï¸ Delete ALL products? This cannot be undone.')) { 
                products = []; 
                saveToFirebase('products', products); 
                resetAdminForm();
                alert('âœ… All products deleted globally');
            } 
        });

        // ========== INITIALIZE ==========
        // Load saved address
        const cartAddress = document.getElementById('cartAddress');
        const modalAddress = document.getElementById('modalDeliveryAddress');
        
        if (userAddress) {
            if (cartAddress) cartAddress.value = userAddress;
            if (modalAddress) modalAddress.value = userAddress;
        }
        
        loadFromFirebase();
        updateCart();
        loadPopup();
        
        // Add some sample products if none exist (for testing)
        setTimeout(() => {
            if (products.length === 0 && !database) {
                const sampleProducts = [
                    {
                        id: 'SM-SAMPLE1',
                        name: 'AIR MAX 270',
                        description: 'Premium comfort running shoes',
                        price: 7999,
                        images: ['https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400'],
                        sizes: ['7', '8', '9', '10'],
                        date: new Date().toISOString(),
                        discount: 10
                    },
                    {
                        id: 'SM-SAMPLE2',
                        name: 'ULTRABOOST 22',
                        description: 'Energy-returning sneakers',
                        price: 12999,
                        images: ['https://images.unsplash.com/photo-1608231387042-66d177aa0f9b?w=400'],
                        sizes: ['6', '7', '8', '9'],
                        date: new Date().toISOString(),
                        discount: null
                    }
                ];
                products = sampleProducts;
                renderProducts();
            }
        }, 3000);
    </script>
</body>
</html>

